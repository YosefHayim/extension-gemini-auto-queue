import{c as g,Q as R,j as e,r as n,C as be,S as oe,e as xe,K as de,a as ge,M as fe,T as J,G as le,E as we,b as ye,d as je,D as ne,o as ve,h as Z,i as W,s as ke,k as G,l as re,m as Ne,n as Ce,g as Se,p as Me,q as $e,t as q,R as ze,f as Ee}from"./client-CZriHQlm.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],te=g("book-marked",_e);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Ae=g("camera",Te);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Pe=g("chevron-down",Fe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Le=g("chevron-left",Ie);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Oe=g("chevron-right",Re);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],De=g("clock",Ue);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],se=g("cpu",Ge);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],ce=g("download",He);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Qe=g("file-text",Ke);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Ve=g("folder-plus",qe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],We=g("folder",Be);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Ye=g("info",Ze);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ie=g("loader-circle",Xe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],et=g("maximize-2",Je);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],st=g("pause",tt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],lt=g("pencil",at);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],rt=g("play",nt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ot=g("plus",it);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ct=g("settings",dt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Y=g("trash-2",pt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ht=g("trending-up",mt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],bt=g("type",ut);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ae=g("upload",xt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],ee=g("wand-sparkles",gt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],H=g("x",ft);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],yt=g("zap",wt),jt={[R.IDLE]:"bg-gray-500/20 text-gray-400",[R.PROCESSING]:"bg-blue-500/20 text-blue-400 animate-pulse",[R.COMPLETED]:"bg-emerald-500/20 text-emerald-400",[R.FAILED]:"bg-red-500/20 text-red-400",[R.PAUSED]:"bg-amber-500/20 text-amber-400"},vt=({status:o})=>e.jsx("div",{className:`px-2 py-0.5 rounded-md text-[9px] font-black uppercase tracking-widest flex items-center gap-1 ${jt[o]}`,children:o}),kt=({onComplete:o,isDark:l})=>{const[i,u]=n.useState(0),m=[{title:"Welcome to Nano Flow",description:"A high-performance bulk image generation engine designed to unlock Gemini's creative potential at scale.",icon:e.jsx(oe,{className:"text-blue-500",size:40})},{title:"The Queue Engine",description:"Paste dozens of prompts or upload a CSV. Use the selection toolbar to weight specific words for the AI.",icon:e.jsx(se,{className:"text-amber-500",size:40})},{title:"Style Library",description:"Manage custom modifiers, instructions, and reference assets in folders. Apply them to your queue in one click.",icon:e.jsx(te,{className:"text-emerald-500",size:40})},{title:"AI Prompt Optimization",description:"Use the magic wand icons to let Gemini analyze and improve your library prompts automatically for better results.",icon:e.jsx(ee,{className:"text-amber-400",size:40})},{title:"Flash vs Pro",description:"Toggle between ultra-fast Flash 2.0 and high-fidelity Imagen 3 models in your application settings.",icon:e.jsx(yt,{className:"text-purple-500",size:40})}];return e.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/80 backdrop-blur-md p-2",children:e.jsx("div",{className:`max-w-md w-full p-6 rounded-md border shadow-2xl animate-in fade-in zoom-in-95 duration-300 ${l?"glass-panel border-white/10":"bg-white border-slate-200"}`,children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white/5 rounded-md shadow-inner border border-white/5 mb-2",children:m[i].icon}),e.jsx("h2",{className:"text-xl font-black tracking-tight",children:m[i].title}),e.jsx("p",{className:"text-sm opacity-60 leading-relaxed font-medium min-h-[60px]",children:m[i].description}),e.jsx("div",{className:"flex gap-1 mb-4",children:m.map((b,j)=>e.jsx("div",{className:`w-1.5 h-1.5 rounded-full transition-all duration-300 ${i===j?"bg-blue-500 w-4":"bg-white/10"}`},j))}),e.jsxs("div",{className:"w-full flex gap-2",children:[i>0?e.jsxs("button",{onClick:()=>u(b=>b-1),className:"flex-1 p-2 rounded-md border border-white/10 text-[10px] font-black uppercase tracking-widest hover:bg-white/5 transition-all flex items-center justify-center gap-2",children:[e.jsx(Le,{size:14})," Back"]}):e.jsx("button",{onClick:o,className:"flex-1 p-2 rounded-md border border-white/10 text-[10px] font-black uppercase opacity-40 hover:opacity-100 transition-all",children:"Skip"}),i<m.length-1?e.jsxs("button",{onClick:()=>u(b=>b+1),className:"flex-[2] p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-black text-[10px] uppercase tracking-widest shadow-lg shadow-blue-600/20 flex items-center justify-center gap-2",children:["Next ",e.jsx(Oe,{size:14})]}):e.jsxs("button",{onClick:o,className:"flex-[2] p-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded-md font-black text-[10px] uppercase tracking-widest shadow-lg shadow-emerald-600/20 flex items-center justify-center gap-2",children:["Get Started ",e.jsx(be,{size:14})]})]})]})})})},Nt=({queue:o,isDark:l,onAddToQueue:i,onRemoveFromQueue:u,onOpenCsvDialog:m})=>{const[b,j]=n.useState(""),[y,C]=n.useState([]),[v,$]=n.useState(null),M=n.useRef(null),O=n.useRef(null),U=()=>{if(M.current){const d=M.current.selectionStart,x=M.current.selectionEnd,S=M.current.value.substring(d,x);S.trim().length>0?$({start:d,end:x,text:S}):$(null)}},_=d=>{if(!v||!M.current)return;const{start:x,end:S,text:k}=v,T=M.current.value;let F="";switch(d){case"standard":F=`(${k}:1.2)`;break;case"heavy":F=`((${k}:1.5))`;break;case"ultra":F=`(((${k}:1.8)))`;break;case"echo":F=`${k}... ${k}`;break}const D=T.substring(0,x)+F+T.substring(S);j(D),$(null),M.current.focus()},A=d=>{Array.from(d.target.files||[]).forEach(S=>{const k=new FileReader;k.onload=T=>{var D;const F=(D=T.target)==null?void 0:D.result;C(V=>[...V,F])},k.readAsDataURL(S)}),d.target.value=""},f=()=>{i(b,void 0,y),j(""),C([])};return e.jsxs("div",{className:"space-y-2 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest opacity-40",children:"Global Input"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{var d;return(d=O.current)==null?void 0:d.click()},className:`p-1.5 rounded-md border transition-all ${l?"bg-white/5 border-white/10":"bg-white border-slate-200 shadow-sm"} ${y.length>0?"text-blue-500 bg-blue-500/10 border-blue-500/30":"opacity-40 hover:opacity-100"}`,children:e.jsx(Ae,{size:14})}),e.jsx("button",{onClick:m,className:`p-1.5 rounded-md border transition-all ${l?"bg-white/5 border-white/10":"bg-white border-slate-200 shadow-sm"} opacity-40 hover:opacity-100`,children:e.jsx(ae,{size:14})}),e.jsx("input",{ref:O,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:A})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:M,value:b,onChange:d=>j(d.target.value),onSelect:U,placeholder:"Enter image instructions...",className:`w-full p-2 text-xs min-h-[140px] rounded-md border outline-none transition-all no-scrollbar leading-relaxed ${l?"bg-black/40 border-white/10 focus:border-blue-500/50":"bg-slate-50 border-slate-200 focus:border-blue-500/50 shadow-inner"}`}),v&&e.jsxs("div",{className:"absolute top-0 right-0 -translate-y-full mb-1 flex gap-1 p-1 bg-blue-600 rounded-md shadow-2xl animate-in fade-in slide-in-from-bottom-1 z-50",children:[e.jsx("button",{onClick:()=>_("standard"),title:"Focus",className:"p-1 hover:bg-white/10 rounded-md",children:e.jsx(bt,{size:12})}),e.jsx("button",{onClick:()=>_("heavy"),title:"Emphasis",className:"p-1 hover:bg-white/10 rounded-md",children:e.jsx(et,{size:12})}),e.jsx("button",{onClick:()=>_("echo"),title:"Highlight",className:"p-1 hover:bg-white/10 rounded-md",children:e.jsx(ht,{size:12})}),e.jsx("button",{onClick:()=>$(null),className:"p-1 hover:bg-white/10 rounded-md border-l border-white/20",children:e.jsx(H,{size:12})})]}),y.length>0&&e.jsx("div",{className:"absolute left-1 bottom-1 flex gap-1 p-1 bg-black/60 rounded-md overflow-x-auto max-w-[160px] no-scrollbar",children:y.map((d,x)=>e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("img",{src:d,className:"w-8 h-8 rounded-md object-cover",alt:"ref"}),e.jsx("button",{onClick:()=>C(S=>S.filter((k,T)=>T!==x)),className:"absolute -top-1 -right-1 bg-red-600 text-white rounded-md p-0.5",children:e.jsx(H,{size:6})})]},x))}),e.jsx("button",{onClick:f,className:"absolute right-2 bottom-2 bg-blue-600 text-white px-3 py-1 rounded-md text-[10px] font-black uppercase shadow-lg shadow-blue-600/30 active:scale-95 transition-all",children:"Enqueue"})]}),e.jsx("div",{className:"pt-2 space-y-1",children:o.length===0?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center opacity-10 gap-2 border-2 border-dashed border-white/5 rounded-md",children:[e.jsx(se,{size:24}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Engine Ready"})]}):o.map(d=>e.jsxs("div",{className:`p-2 rounded-md border group transition-all ${l?"bg-white/2 border-white/5":"bg-white border-slate-100 shadow-sm"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(vt,{status:d.status}),e.jsx("button",{onClick:()=>u(d.id),className:"opacity-0 group-hover:opacity-100 text-red-500/40 hover:text-red-500 transition-all p-1",children:e.jsx(Y,{size:12})})]}),e.jsxs("p",{className:"text-[10px] font-medium leading-tight line-clamp-2 opacity-80",children:['"',d.originalPrompt,'"']}),d.images&&d.images.length>0&&e.jsx("div",{className:"flex gap-1 mt-2",children:d.images.slice(0,4).map((x,S)=>e.jsx("img",{src:x,className:"w-6 h-6 rounded-md object-cover border border-white/5",alt:"ref"},S))})]},d.id))})]})},Ct=({folders:o,isDark:l,onCreateFolder:i,onDeleteFolder:u,onToggleFolder:m,onUseTemplate:b,onDeleteTemplate:j,onSaveTemplate:y,onImproveTemplate:C,onImproveFolder:v})=>{const[$,M]=n.useState(!1),[O,U]=n.useState(""),[_,A]=n.useState(new Set),[f,d]=n.useState(null),x=n.useRef(null),S=()=>{O.trim()&&(i(O.trim()),U(""),M(!1))},k=(a,c)=>{c.stopPropagation(),confirm("Delete folder and all templates inside?")&&u(a)},T=(a,c,w)=>{w.stopPropagation(),confirm("Delete this template?")&&j(a,c)},F=(a,c,w)=>{if(w&&(w.stopPropagation(),w.preventDefault()),c){const z=o.find(I=>I.id===a),N=z==null?void 0:z.templates.find(I=>I.id===c);N&&d({folderId:a,template:{...N}})}else d({folderId:a,template:{id:Math.random().toString(36).substr(2,9),name:"",text:"",createdAt:Date.now(),lastEditedAt:Date.now(),timesUsed:0,images:[]}})},D=()=>{!f||!f.template.name||(y(f.folderId,f.template),d(null))},V=async(a,c,w)=>{w.stopPropagation(),A(z=>new Set(z).add(c));try{await C(a,c)}finally{A(z=>{const N=new Set(z);return N.delete(c),N})}},X=async(a,c)=>{c.stopPropagation();const w=o.find(N=>N.id===a);if(!w)return;const z=w.templates.map(N=>N.id);A(N=>new Set([...Array.from(N),...z,a]));try{await v(a)}finally{A(N=>{const I=new Set(N);return z.forEach(K=>I.delete(K)),I.delete(a),I})}},B=a=>{Array.from(a.target.files||[]).forEach(w=>{const z=new FileReader;z.onload=N=>{var K;const I=(K=N.target)==null?void 0:K.result;f&&d(Q=>Q?{...Q,template:{...Q.template,images:[...Q.template.images||[],I]}}:null)},z.readAsDataURL(w)}),a.target.value=""};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("span",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest",children:"Managed Collections"}),e.jsx("button",{onClick:()=>M(!0),className:"p-1.5 rounded-md bg-blue-500/10 text-blue-500 hover:bg-blue-600 hover:text-white transition-all shadow-sm",children:e.jsx(Ve,{size:14})})]}),e.jsxs("div",{className:"space-y-2",children:[o.map(a=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>m(a.id),className:`flex-1 flex items-center gap-2 p-2 rounded-md border text-xs font-black transition-all ${l?"bg-white/5 border-white/5 hover:bg-white/10":"bg-slate-50 border-slate-100 hover:bg-slate-100"}`,children:[e.jsx(We,{size:14,className:"text-blue-500"}),e.jsx("span",{className:"flex-1 text-left",children:a.name}),e.jsx(Pe,{size:14,className:`transition-transform duration-300 ${a.isOpen?"rotate-180":""}`})]}),e.jsx("button",{onClick:c=>X(a.id,c),disabled:_.has(a.id),title:"Improve all prompts in folder",className:`p-2 rounded-md transition-all ${_.has(a.id)?"bg-amber-500 text-white animate-pulse":"bg-amber-500/10 text-amber-500/60 hover:bg-amber-600 hover:text-white"}`,children:_.has(a.id)?e.jsx(ie,{size:14,className:"animate-spin"}):e.jsx(ee,{size:14})}),e.jsx("button",{onClick:c=>k(a.id,c),className:"p-2 rounded-md bg-red-500/10 text-red-500/60 hover:bg-red-600 hover:text-white transition-all",children:e.jsx(Y,{size:14})})]}),a.isOpen&&e.jsxs("div",{className:"space-y-1 mt-1 animate-in slide-in-from-top-1",children:[a.templates.map(c=>e.jsx("div",{className:`group flex flex-col p-2 rounded-md border shadow-sm transition-all ${l?"bg-white/2 border-white/5 hover:border-blue-500/30":"bg-white border-slate-50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>b(a.id,c.id),children:[e.jsx("p",{className:"text-[10px] font-black text-blue-500 truncate",children:c.name}),e.jsxs("p",{className:"text-[9px] opacity-40 truncate",children:['"',c.text,'"']})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-all",children:[e.jsx("button",{onClick:w=>V(a.id,c.id,w),disabled:_.has(c.id),className:`p-1 rounded-md transition-all ${_.has(c.id)?"bg-amber-500 text-white animate-pulse":"hover:bg-amber-500/20 text-amber-500"}`,title:"AI Optimization",children:_.has(c.id)?e.jsx(ie,{size:12,className:"animate-spin"}):e.jsx(ee,{size:12})}),e.jsx("button",{onClick:w=>F(a.id,c.id,w),className:"p-1 rounded-md hover:bg-blue-500/20",children:e.jsx(lt,{size:12})}),e.jsx("button",{onClick:w=>T(a.id,c.id,w),className:"p-1 rounded-md hover:bg-red-500/20 text-red-500",children:e.jsx(Y,{size:12})}),e.jsx("button",{onClick:()=>b(a.id,c.id),className:"p-1 rounded-md bg-blue-600 text-white shadow-lg",children:e.jsx(ot,{size:12})})]})]})},c.id)),e.jsx("button",{onClick:c=>F(a.id,void 0,c),className:"w-full p-2 rounded-md border-2 border-dashed border-white/5 text-[9px] font-black uppercase opacity-20 hover:opacity-100 transition-all",children:"New Style"})]})]},a.id)),o.length===0&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center opacity-10 gap-2 border-2 border-dashed border-white/5 rounded-md",children:[e.jsx(te,{size:24}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Library Empty"})]})]})]}),$&&e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/80 backdrop-blur-md p-2",children:e.jsxs("div",{className:`max-w-md w-full p-2 rounded-md border shadow-2xl ${l?"glass-panel border-white/10":"bg-white border-slate-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsx("h2",{className:"text-sm font-black",children:"New Folder"}),e.jsx("button",{onClick:()=>M(!1),className:"p-1 hover:bg-white/5 rounded-md transition-all",children:e.jsx(H,{size:18})})]}),e.jsxs("div",{className:"p-2 space-y-2",children:[e.jsx("input",{autoFocus:!0,value:O,onChange:a=>U(a.target.value),onKeyDown:a=>a.key==="Enter"&&S(),placeholder:"Folder Name",className:`w-full p-2 rounded-md outline-none border text-xs font-bold ${l?"bg-black/40 border-white/10":"bg-slate-50 border-slate-200"}`}),e.jsx("button",{onClick:S,className:"w-full p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-black text-xs",children:"Create"})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 z-[900] flex items-center justify-center bg-black/80 backdrop-blur-md p-2",children:e.jsxs("div",{className:`max-w-xl w-full p-2 rounded-md border shadow-2xl ${l?"glass-panel border-white/10":"bg-white border-slate-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsx("h2",{className:"text-sm font-black",children:f.template.createdAt?"Refine Prompt":"New Library Entry"}),e.jsx("button",{onClick:()=>d(null),className:"p-1 hover:bg-white/5 rounded-md",children:e.jsx(H,{size:18})})]}),e.jsxs("div",{className:"p-2 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase opacity-40 ml-1",children:"Template Title"}),e.jsx("input",{autoFocus:!0,value:f.template.name,onChange:a=>d({...f,template:{...f.template,name:a.target.value}}),placeholder:"e.g. Dreamy Portrait",className:`w-full p-2 rounded-md outline-none border font-bold text-xs ${l?"bg-black/40 border-white/10":"bg-slate-50 border-slate-200"}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase opacity-40 ml-1",children:"Logic / Modifiers"}),e.jsx("textarea",{value:f.template.text,onChange:a=>d({...f,template:{...f.template,text:a.target.value}}),placeholder:"Add instructions...",className:`w-full p-2 rounded-md outline-none border min-h-[100px] text-xs ${l?"bg-black/40 border-white/10":"bg-slate-50 border-slate-200"}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase opacity-40 ml-1",children:"Assets"}),e.jsxs("div",{onClick:()=>{var a;return(a=x.current)==null?void 0:a.click()},className:`p-2 rounded-md border-2 border-dashed transition-all cursor-pointer flex flex-wrap gap-1 min-h-[80px] items-center justify-center ${l?"bg-white/5 border-white/10 hover:border-blue-500/50":"bg-slate-50 border-slate-200 hover:border-blue-500/50"}`,children:[e.jsx("input",{ref:x,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:B}),!f.template.images||f.template.images.length===0?e.jsxs("div",{className:"flex flex-col items-center gap-1 opacity-20",children:[e.jsx(ae,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Select Files"})]}):f.template.images.map((a,c)=>e.jsxs("div",{className:"relative group/asset",onClick:w=>w.stopPropagation(),children:[e.jsx("img",{src:a,className:"w-12 h-12 rounded-md object-cover border border-white/10 shadow-md",alt:"ref"}),e.jsx("button",{onClick:()=>{var w;return d({...f,template:{...f.template,images:(w=f.template.images)==null?void 0:w.filter((z,N)=>N!==c)}})},className:"absolute -top-1.5 -right-1.5 bg-red-600 text-white rounded-md p-1 shadow-lg scale-75 hover:scale-100 transition-transform",children:e.jsx(H,{size:8})})]},c))]})]}),e.jsxs("button",{onClick:D,className:"w-full p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-black text-xs flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(xe,{size:14})," Commit to Library"]})]})]})})]})},St=({settings:o,isDark:l,hasApiKey:i,onUpdateSettings:u,onOpenApiKeyDialog:m})=>e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-300",children:[e.jsx("div",{className:`p-2 space-y-2 border rounded-md ${l?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest",children:"API Key"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-[9px] font-black uppercase ${i?"text-emerald-500":"text-amber-500"}`,children:i?"Configured":"Not Set"}),e.jsxs("button",{onClick:m,className:`p-2 rounded-md transition-all flex items-center gap-2 text-[10px] font-black uppercase border ${l?"bg-white/5 border-white/10":"bg-white border-slate-200"}`,children:[e.jsx(de,{size:12,className:i?"text-emerald-500":"text-amber-500"}),i?"Update":"Configure"]})]})]})}),e.jsx("div",{className:`p-2 space-y-2 border rounded-md ${l?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest",children:"Interface Theme"}),e.jsxs("button",{onClick:()=>u({theme:l?J.LIGHT:J.DARK}),className:`p-2 rounded-md transition-all flex items-center gap-2 text-[10px] font-black uppercase border ${l?"bg-white/5 border-white/10":"bg-slate-100 border-slate-200"}`,children:[l?e.jsx(ge,{size:12,className:"text-amber-400"}):e.jsx(fe,{size:12,className:"text-blue-500"}),l?"Switch to Light":"Switch to Dark"]})]})}),e.jsxs("div",{className:`p-2 space-y-2 border rounded-md ${l?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest ml-1",children:"Active Synthesis Model"}),e.jsxs("select",{value:o.primaryModel,onChange:b=>u({primaryModel:b.target.value}),className:`w-full p-2 rounded-md border text-[10px] font-black uppercase transition-all appearance-none outline-none ${l?"bg-black/40 border-white/10 focus:border-blue-500/50":"bg-white border-slate-200 shadow-sm"}`,children:[e.jsx("option",{value:le.FLASH,children:"Flash 2.0 (High Speed)"}),e.jsx("option",{value:le.PRO,children:"Imagen 3 (High Fidelity)"})]})]}),e.jsxs("div",{className:`p-2 space-y-2 border rounded-md ${l?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest ml-1",children:"Global Prefix"}),e.jsx("input",{value:o.prefix,onChange:b=>u({prefix:b.target.value}),placeholder:"Text to prepend to all prompts...",className:`w-full p-2 rounded-md border text-xs outline-none ${l?"bg-black/40 border-white/10":"bg-white border-slate-200"}`})]}),e.jsxs("div",{className:`p-2 space-y-2 border rounded-md ${l?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest ml-1",children:"Global Suffix"}),e.jsx("input",{value:o.suffix,onChange:b=>u({suffix:b.target.value}),placeholder:"Text to append to all prompts...",className:`w-full p-2 rounded-md border text-xs outline-none ${l?"bg-black/40 border-white/10":"bg-white border-slate-200"}`})]}),e.jsxs("div",{className:`p-2 space-y-2 border rounded-md ${l?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest ml-1",children:"Global Negative Prompts"}),e.jsx("textarea",{value:o.globalNegatives,onChange:b=>u({globalNegatives:b.target.value}),placeholder:"Things to avoid in all generations...",className:`w-full p-2 rounded-md border text-xs outline-none min-h-[60px] ${l?"bg-black/40 border-white/10":"bg-white border-slate-200"}`})]}),e.jsx("div",{className:`p-2 space-y-2 border rounded-md ${l?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest block",children:"Drip Feed Mode"}),e.jsx("p",{className:"text-[8px] opacity-30 mt-1",children:"Add random delays between generations"})]}),e.jsx("button",{onClick:()=>u({dripFeed:!o.dripFeed}),className:`w-10 h-5 rounded-full transition-all relative ${o.dripFeed?"bg-blue-600":"bg-white/10"}`,children:e.jsx("div",{className:`absolute w-4 h-4 rounded-full bg-white top-0.5 transition-all shadow-md ${o.dripFeed?"left-5":"left-0.5"}`})})]})})]}),Mt=({isOpen:o,isDark:l,onClose:i,onUpload:u})=>{const m=n.useRef(null),b=()=>{const y=`Prompt,Template Modifier
A cyberpunk city,hyper-realistic 8k resolution
A majestic dragon,anime studio ghibli style
A cozy cabin,winter forest background`,C=new Blob([y],{type:"text/csv;charset=utf-8;"}),v=document.createElement("a"),$=URL.createObjectURL(C);v.setAttribute("href",$),v.setAttribute("download","nano_flow_template.csv"),v.style.visibility="hidden",document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL($)},j=y=>{var $;const C=($=y.target.files)==null?void 0:$[0];if(!C)return;const v=new FileReader;v.onload=M=>{var A;const U=((A=M.target)==null?void 0:A.result).split(`
`),_=[];U.forEach(f=>{var k,T;const d=f.split(","),x=(k=d[0])==null?void 0:k.trim(),S=(T=d[1])==null?void 0:T.trim();x&&x.toLowerCase()!=="prompt"&&_.push({prompt:x,modifier:S})}),u(_),i()},v.readAsText(C),m.current&&(m.current.value="")};return o?e.jsx("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center bg-black/80 backdrop-blur-md p-2",children:e.jsxs("div",{className:`max-w-md w-full p-2 rounded-md border shadow-2xl ${l?"glass-panel border-white/10":"bg-white border-slate-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{size:18,className:"text-blue-500"}),e.jsx("h2",{className:"text-sm font-black",children:"Import Batch"})]}),e.jsx("button",{onClick:i,className:"p-1 hover:bg-white/5 rounded-md transition-all",children:e.jsx(H,{size:18})})]}),e.jsxs("div",{className:"p-2 space-y-2",children:[e.jsxs("div",{className:`p-2 rounded-md border text-[10px] leading-tight ${l?"bg-white/5 border-white/5 opacity-70":"bg-slate-50 border-slate-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-1 font-black uppercase tracking-widest mb-1",children:[e.jsx(Ye,{size:10})," CSV Guide"]}),"Format: Prompt, Modifiers (Optional)."]}),e.jsxs("button",{onClick:b,className:`w-full p-2 rounded-md font-black text-xs flex items-center justify-center gap-2 border ${l?"bg-white/5 border-white/10":"bg-white border-slate-200"}`,children:[e.jsx(ce,{size:16})," Get Template"]}),e.jsxs("button",{onClick:()=>{var y;return(y=m.current)==null?void 0:y.click()},className:"w-full p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-black text-xs flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(ae,{size:16})," Upload CSV"]}),e.jsx("input",{ref:m,type:"file",accept:".csv",className:"hidden",onChange:j})]})]})}):null},$t=({isOpen:o,isDark:l,currentKey:i,onClose:u,onSave:m})=>{const[b,j]=n.useState(i||""),[y,C]=n.useState(!1),v=()=>{b.trim()&&(m(b.trim()),u())};return o?e.jsx("div",{className:"fixed inset-0 z-[1200] flex items-center justify-center bg-black/80 backdrop-blur-md p-2",children:e.jsxs("div",{className:`max-w-md w-full p-2 rounded-md border shadow-2xl ${l?"glass-panel border-white/10":"bg-white border-slate-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{size:18,className:"text-blue-500"}),e.jsx("h2",{className:"text-sm font-black",children:"API Key Configuration"})]}),e.jsx("button",{onClick:u,className:"p-1 hover:bg-white/5 rounded-md transition-all",children:e.jsx(H,{size:18})})]}),e.jsxs("div",{className:"p-2 space-y-3",children:[e.jsxs("div",{className:`p-2 rounded-md border text-[10px] leading-tight ${l?"bg-white/5 border-white/5 opacity-70":"bg-slate-50 border-slate-100"}`,children:[e.jsx("p",{className:"mb-2",children:"Get your Gemini API key from Google AI Studio. Your key is stored locally and never sent to external servers."}),e.jsxs("a",{href:"https://aistudio.google.com/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline flex items-center gap-1",children:["Get API Key ",e.jsx(we,{size:10})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase opacity-40 ml-1",children:"Gemini API Key"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:y?"text":"password",value:b,onChange:$=>j($.target.value),placeholder:"AIzaSy...",className:`w-full p-2 pr-10 rounded-md outline-none border font-mono text-xs ${l?"bg-black/40 border-white/10":"bg-slate-50 border-slate-200"}`}),e.jsx("button",{type:"button",onClick:()=>C(!y),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 opacity-40 hover:opacity-100",children:y?e.jsx(ye,{size:14}):e.jsx(je,{size:14})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:u,className:`flex-1 p-2 rounded-md font-black text-xs border ${l?"bg-white/5 border-white/10":"bg-white border-slate-200"}`,children:"Cancel"}),e.jsx("button",{onClick:v,disabled:!b.trim(),className:"flex-1 p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-black text-xs shadow-lg disabled:opacity-50",children:"Save Key"})]})]})]})}):null};function zt(){const[o,l]=n.useState([]),[i,u]=n.useState([]),[m,b]=n.useState(ne),[j,y]=n.useState(!1),[C,v]=n.useState("queue"),[$,M]=n.useState(0),[O,U]=n.useState(!1),[_,A]=n.useState(!1),[f,d]=n.useState(!1),x=m.theme===J.DARK;n.useEffect(()=>{(async()=>{const[t,r,p,h]=await Promise.all([Ce(),Se(),Me(),$e()]);l(t),b(r),u(p),U(!h)})()},[]),n.useEffect(()=>ve(t=>{t[q.QUEUE]&&l(t[q.QUEUE].newValue||[]),t[q.SETTINGS]&&b(t[q.SETTINGS].newValue||ne),t[q.FOLDERS]&&u(t[q.FOLDERS].newValue||[])}),[]),n.useEffect(()=>{const s=t=>{t.type===W.PROCESS_QUEUE?y(!0):t.type===W.STOP_PROCESSING?y(!1):t.type===W.UPDATE_QUEUE&&l(t.payload)};return chrome.runtime.onMessage.addListener(s),()=>chrome.runtime.onMessage.removeListener(s)},[]),n.useEffect(()=>{let s;return j?s=setInterval(()=>M(t=>t+100),100):M(0),()=>clearInterval(s)},[j]);const S=async s=>chrome.runtime.sendMessage(s),k=n.useCallback(s=>{var r;let t=`${m.prefix} ${s} ${m.suffix}`.trim();return(r=m.globalNegatives)!=null&&r.trim()&&(t+=`. NOT ${m.globalNegatives.trim()}`),t},[m.prefix,m.suffix,m.globalNegatives]),T=n.useCallback(async(s,t,r)=>{const P=(s||"").split(/[,\n]/).map(L=>L.trim()).filter(L=>L!=="").map(L=>{const ue=t?`${L} ${t}`:L;return{id:Math.random().toString(36).substr(2,9),originalPrompt:L,finalPrompt:k(ue),status:R.IDLE,images:r&&r.length>0?[...r]:void 0}}),E=[...o,...P];l(E),await Z(E)},[o,k]),F=n.useCallback(async s=>{const t=o.filter(r=>r.id!==s);l(t),await Z(t)},[o]),D=n.useCallback(async()=>{const s=o.filter(t=>t.status!==R.COMPLETED);l(s),await Z(s)},[o]),V=n.useCallback(async s=>{const t=s.map(p=>{const h=p.modifier?`${p.prompt} ${p.modifier}`:p.prompt;return{id:Math.random().toString(36).substr(2,9),originalPrompt:p.prompt,finalPrompt:k(h),status:R.IDLE}}),r=[...o,...t];l(r),await Z(r)},[o,k]),X=n.useCallback(async()=>{j?(await S({type:W.STOP_PROCESSING}),y(!1)):(await S({type:W.PROCESS_QUEUE}),y(!0))},[j]),B=n.useCallback(async s=>{const t={...m,...s};b(t),await ke(t)},[m]),a=n.useCallback(async s=>{await B({apiKey:s})},[B]),c=n.useCallback(async s=>{const t={id:Math.random().toString(36).substr(2,9),name:s,templates:[],isOpen:!0},r=[...i,t];u(r),await G(r)},[i]),w=n.useCallback(async s=>{const t=i.filter(r=>r.id!==s);u(t),await G(t)},[i]),z=n.useCallback(async s=>{const t=i.map(r=>r.id===s?{...r,isOpen:!r.isOpen}:r);u(t),await G(t)},[i]),N=n.useCallback((s,t)=>{const r=i.find(h=>h.id===s),p=r==null?void 0:r.templates.find(h=>h.id===t);p&&(T(p.text,void 0,p.images),v("queue"))},[i,T]),I=n.useCallback(async(s,t)=>{const r=i.map(p=>p.id===s?{...p,templates:p.templates.filter(h=>h.id!==t)}:p);u(r),await G(r)},[i]),K=n.useCallback(async(s,t)=>{const r=i.map(p=>{if(p.id===s){const h=p.templates.findIndex(E=>E.id===t.id),P={id:t.id||Math.random().toString(36).substr(2,9),name:t.name||"Unnamed",text:t.text||"",createdAt:t.createdAt||Date.now(),lastEditedAt:Date.now(),timesUsed:t.timesUsed||0,images:t.images||[]};if(h>-1){const E=[...p.templates];return E[h]=P,{...p,templates:E}}else return{...p,templates:[...p.templates,P]}}return p});u(r),await G(r)},[i]),Q=n.useCallback(async(s,t)=>{const r=i.find(h=>h.id===s),p=r==null?void 0:r.templates.find(h=>h.id===t);if(p){const h=await re(p.text),P=i.map(E=>E.id===s?{...E,templates:E.templates.map(L=>L.id===t?{...L,text:h,lastEditedAt:Date.now()}:L)}:E);u(P),await G(P)}},[i]),me=n.useCallback(async s=>{const t=i.find(h=>h.id===s);if(!t)return;const r=await Promise.all(t.templates.map(async h=>{const P=await re(h.text);return{...h,text:P,lastEditedAt:Date.now()}})),p=i.map(h=>h.id===s?{...h,templates:r}:h);u(p),await G(p)},[i]),he=n.useCallback(async()=>{await Ne(!0),U(!1)},[]);return e.jsxs("div",{className:`flex flex-col h-screen w-full overflow-hidden transition-colors duration-500 ${x?"bg-[#0a0a0a] text-white":"bg-[#f8fafc] text-[#1e293b]"}`,children:[O&&e.jsx(kt,{onComplete:he,isDark:x}),e.jsx(Mt,{isOpen:_,isDark:x,onClose:()=>A(!1),onUpload:V}),e.jsx($t,{isOpen:f,isDark:x,currentKey:m.apiKey,onClose:()=>d(!1),onSave:a}),e.jsxs("div",{className:`p-2 flex items-center justify-between border-b ${x?"border-white/10 bg-white/5":"border-slate-100 bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1 rounded-md bg-blue-600 shadow-lg shadow-blue-600/20",children:e.jsx(oe,{size:16,className:"text-white"})}),e.jsx("h1",{className:"text-sm font-black tracking-tight",children:"Nano Flow"})]}),j&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-blue-500/10 rounded-md border border-blue-500/20",children:[e.jsx(De,{size:10,className:"text-blue-500 animate-spin"}),e.jsxs("span",{className:"text-[10px] font-black text-blue-500",children:[($/1e3).toFixed(1),"s"]})]})]}),e.jsx("nav",{className:`flex border-b overflow-hidden ${x?"border-white/5 bg-white/2":"border-slate-100"}`,children:[{id:"queue",icon:se,label:"Queue Engine"},{id:"templates",icon:te,label:"Style Library"},{id:"settings",icon:ct,label:"Settings"}].map(s=>e.jsxs("button",{onClick:()=>v(s.id),className:`flex-1 py-3 text-[8px] font-black uppercase tracking-widest flex flex-col items-center gap-1 transition-all relative ${C===s.id?"text-blue-500":"opacity-40 hover:opacity-100"}`,children:[e.jsx(s.icon,{size:14}),e.jsx("span",{className:"truncate w-full text-center px-1",children:s.label}),C===s.id&&e.jsx("div",{className:"absolute bottom-0 left-2 right-2 h-0.5 bg-blue-500 rounded-t-md"})]},s.id))}),e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar p-2",children:[C==="queue"&&e.jsx(Nt,{queue:o,isDark:x,onAddToQueue:T,onRemoveFromQueue:F,onOpenCsvDialog:()=>A(!0)}),C==="templates"&&e.jsx(Ct,{folders:i,isDark:x,onCreateFolder:c,onDeleteFolder:w,onToggleFolder:z,onUseTemplate:N,onDeleteTemplate:I,onSaveTemplate:K,onImproveTemplate:Q,onImproveFolder:me}),C==="settings"&&e.jsx(St,{settings:m,isDark:x,hasApiKey:!!m.apiKey,onUpdateSettings:B,onOpenApiKeyDialog:()=>d(!0)})]}),e.jsxs("div",{className:`p-2 border-t space-y-2 ${x?"bg-black/80 border-white/10 backdrop-blur-xl":"bg-slate-50 border-slate-200"}`,children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:D,className:"flex-1 p-2 rounded-md border text-[10px] font-black uppercase hover:bg-red-500 hover:text-white transition-all border-white/10",children:e.jsx(Y,{size:14,className:"mx-auto"})}),e.jsxs("button",{onClick:X,disabled:o.length===0,className:`flex-[4] p-2 rounded-md flex items-center justify-center gap-2 text-xs font-black uppercase shadow-xl transition-all active:scale-[0.98] ${j?"bg-amber-500 shadow-amber-500/30":"bg-blue-600 shadow-blue-600/30"} text-white disabled:opacity-30`,children:[j?e.jsx(st,{size:16,fill:"currentColor"}):e.jsx(rt,{size:16,fill:"currentColor"}),j?"Halt Flow":"Ignite Engine"]})]}),o.filter(s=>s.status===R.COMPLETED).length>0&&e.jsx("div",{className:"flex gap-1 overflow-x-auto no-scrollbar py-1",children:o.filter(s=>s.status===R.COMPLETED).slice(-5).map(s=>{var r,p,h,P;const t=((p=(r=s.results)==null?void 0:r.flash)==null?void 0:p.url)||((P=(h=s.results)==null?void 0:h.pro)==null?void 0:P.url);return t?e.jsxs("div",{className:"relative group shrink-0",children:[e.jsx("img",{src:t,className:"w-12 h-12 rounded-md object-cover border border-white/10",alt:"Result"}),e.jsx("button",{onClick:()=>{const E=document.createElement("a");E.href=t,E.download=`nano_flow_${s.id}.png`,E.click()},className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all flex items-center justify-center rounded-md",children:e.jsx(ce,{size:12,className:"text-white"})})]},s.id):null})})]})]})}const pe=document.getElementById("root");if(!pe)throw new Error("Could not find root element to mount to");const Et=ze.createRoot(pe);Et.render(e.jsx(Ee.StrictMode,{children:e.jsx(zt,{})}));

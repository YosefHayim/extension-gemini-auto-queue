import{c as g,r as i,j as e,K as de,E as xe,b as ge,d as fe,C as we,S as ce,Q as R,a as ye,M as ve,T as ee,G as ne,h as W,e as je,D as ie,o as Ne,i as Y,k as Z,s as ke,l as D,m as re,n as Ce,p as Se,g as $e,q as Me,t as ze,u as q,R as Ee,f as Te}from"./client-ZVFp-tEl.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],ae=g("book-marked",_e);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Ae=g("camera",Fe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Ie=g("chevron-down",Pe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Re=g("chevron-left",Le);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ue=g("chevron-right",Oe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],De=g("clock",Ge);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],se=g("cpu",Qe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],pe=g("download",He);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],qe=g("file-text",Ke);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Be=g("folder-plus",Ve);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Ze=g("folder",We);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Xe=g("info",Ye);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],oe=g("loader-circle",Je);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],tt=g("maximize-2",et);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]],st=g("panel-left",at);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}]],nt=g("panel-right",lt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],rt=g("pause",it);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],dt=g("pencil",ot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],pt=g("play",ct);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ht=g("plus",mt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],bt=g("settings",ut);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],X=g("trash-2",xt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ft=g("trending-up",gt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],yt=g("type",wt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],le=g("upload",vt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],te=g("wand-sparkles",jt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Q=g("x",Nt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Ct=g("zap",kt),St=({isOpen:n,isDark:s,currentKey:o,onClose:h,onSave:p})=>{const[b,v]=i.useState(o||""),[y,C]=i.useState(!1),j=()=>{b.trim()&&(p(b.trim()),h())};return n?e.jsx("div",{className:"fixed inset-0 z-[1200] flex items-center justify-center bg-black/80 backdrop-blur-md p-2",children:e.jsxs("div",{className:`max-w-md w-full p-2 rounded-md border shadow-2xl ${s?"glass-panel border-white/10":"bg-white border-slate-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{size:18,className:"text-blue-500"}),e.jsx("h2",{className:"text-sm font-black",children:"API Key Configuration"})]}),e.jsx("button",{onClick:h,className:"p-1 hover:bg-white/5 rounded-md transition-all",children:e.jsx(Q,{size:18})})]}),e.jsxs("div",{className:"p-2 space-y-3",children:[e.jsxs("div",{className:`p-2 rounded-md border text-[10px] leading-tight ${s?"bg-white/5 border-white/5 opacity-70":"bg-slate-50 border-slate-100"}`,children:[e.jsx("p",{className:"mb-2",children:"Get your Gemini API key from Google AI Studio. Your key is stored locally and never sent to external servers."}),e.jsxs("a",{href:"https://aistudio.google.com/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline flex items-center gap-1",children:["Get API Key ",e.jsx(xe,{size:10})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase opacity-40 ml-1",children:"Gemini API Key"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:y?"text":"password",value:b,onChange:M=>v(M.target.value),placeholder:"AIzaSy...",className:`w-full p-2 pr-10 rounded-md outline-none border font-mono text-xs ${s?"bg-black/40 border-white/10":"bg-slate-50 border-slate-200"}`}),e.jsx("button",{type:"button",onClick:()=>C(!y),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 opacity-40 hover:opacity-100",children:y?e.jsx(ge,{size:14}):e.jsx(fe,{size:14})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,className:`flex-1 p-2 rounded-md font-black text-xs border ${s?"bg-white/5 border-white/10":"bg-white border-slate-200"}`,children:"Cancel"}),e.jsx("button",{onClick:j,disabled:!b.trim(),className:"flex-1 p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-black text-xs shadow-lg disabled:opacity-50",children:"Save Key"})]})]})]})}):null},$t=({isOpen:n,isDark:s,onClose:o,onUpload:h})=>{const p=i.useRef(null),b=()=>{const y=`Prompt,Template Modifier
A cyberpunk city,hyper-realistic 8k resolution
A majestic dragon,anime studio ghibli style
A cozy cabin,winter forest background`,C=new Blob([y],{type:"text/csv;charset=utf-8;"}),j=document.createElement("a"),M=URL.createObjectURL(C);j.setAttribute("href",M),j.setAttribute("download","nano_flow_template.csv"),j.style.visibility="hidden",document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(M)},v=y=>{var M;const C=(M=y.target.files)==null?void 0:M[0];if(!C)return;const j=new FileReader;j.onload=$=>{var F;const U=((F=$.target)==null?void 0:F.result).split(`
`),T=[];U.forEach(f=>{var N,_;const d=f.split(","),x=(N=d[0])==null?void 0:N.trim(),S=(_=d[1])==null?void 0:_.trim();x&&x.toLowerCase()!=="prompt"&&T.push({prompt:x,modifier:S})}),h(T),o()},j.readAsText(C),p.current&&(p.current.value="")};return n?e.jsx("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center bg-black/80 backdrop-blur-md p-2",children:e.jsxs("div",{className:`max-w-md w-full p-2 rounded-md border shadow-2xl ${s?"glass-panel border-white/10":"bg-white border-slate-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{size:18,className:"text-blue-500"}),e.jsx("h2",{className:"text-sm font-black",children:"Import Batch"})]}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-white/5 rounded-md transition-all",children:e.jsx(Q,{size:18})})]}),e.jsxs("div",{className:"p-2 space-y-2",children:[e.jsxs("div",{className:`p-2 rounded-md border text-[10px] leading-tight ${s?"bg-white/5 border-white/5 opacity-70":"bg-slate-50 border-slate-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-1 font-black uppercase tracking-widest mb-1",children:[e.jsx(Xe,{size:10})," CSV Guide"]}),"Format: Prompt, Modifiers (Optional)."]}),e.jsxs("button",{onClick:b,className:`w-full p-2 rounded-md font-black text-xs flex items-center justify-center gap-2 border ${s?"bg-white/5 border-white/10":"bg-white border-slate-200"}`,children:[e.jsx(pe,{size:16})," Get Template"]}),e.jsxs("button",{onClick:()=>{var y;return(y=p.current)==null?void 0:y.click()},className:"w-full p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-black text-xs flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(le,{size:16})," Upload CSV"]}),e.jsx("input",{ref:p,type:"file",accept:".csv",className:"hidden",onChange:v})]})]})}):null},Mt=({onComplete:n,isDark:s})=>{const[o,h]=i.useState(0),p=[{title:"Welcome to Nano Flow",description:"A high-performance bulk image generation engine designed to unlock Gemini's creative potential at scale.",icon:e.jsx(ce,{className:"text-blue-500",size:40})},{title:"The Queue Engine",description:"Paste dozens of prompts or upload a CSV. Use the selection toolbar to weight specific words for the AI.",icon:e.jsx(se,{className:"text-amber-500",size:40})},{title:"Style Library",description:"Manage custom modifiers, instructions, and reference assets in folders. Apply them to your queue in one click.",icon:e.jsx(ae,{className:"text-emerald-500",size:40})},{title:"AI Prompt Optimization",description:"Use the magic wand icons to let Gemini analyze and improve your library prompts automatically for better results.",icon:e.jsx(te,{className:"text-amber-400",size:40})},{title:"Flash vs Pro",description:"Toggle between ultra-fast Flash 2.0 and high-fidelity Imagen 3 models in your application settings.",icon:e.jsx(Ct,{className:"text-purple-500",size:40})}];return e.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/80 backdrop-blur-md p-2",children:e.jsx("div",{className:`max-w-md w-full p-6 rounded-md border shadow-2xl animate-in fade-in zoom-in-95 duration-300 ${s?"glass-panel border-white/10":"bg-white border-slate-200"}`,children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white/5 rounded-md shadow-inner border border-white/5 mb-2",children:p[o].icon}),e.jsx("h2",{className:"text-xl font-black tracking-tight",children:p[o].title}),e.jsx("p",{className:"text-sm opacity-60 leading-relaxed font-medium min-h-[60px]",children:p[o].description}),e.jsx("div",{className:"flex gap-1 mb-4",children:p.map((b,v)=>e.jsx("div",{className:`w-1.5 h-1.5 rounded-full transition-all duration-300 ${o===v?"bg-blue-500 w-4":"bg-white/10"}`},v))}),e.jsxs("div",{className:"w-full flex gap-2",children:[o>0?e.jsxs("button",{onClick:()=>h(b=>b-1),className:"flex-1 p-2 rounded-md border border-white/10 text-[10px] font-black uppercase tracking-widest hover:bg-white/5 transition-all flex items-center justify-center gap-2",children:[e.jsx(Re,{size:14})," Back"]}):e.jsx("button",{onClick:n,className:"flex-1 p-2 rounded-md border border-white/10 text-[10px] font-black uppercase opacity-40 hover:opacity-100 transition-all",children:"Skip"}),o<p.length-1?e.jsxs("button",{onClick:()=>h(b=>b+1),className:"flex-[2] p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-black text-[10px] uppercase tracking-widest shadow-lg shadow-blue-600/20 flex items-center justify-center gap-2",children:["Next ",e.jsx(Ue,{size:14})]}):e.jsxs("button",{onClick:n,className:"flex-[2] p-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded-md font-black text-[10px] uppercase tracking-widest shadow-lg shadow-emerald-600/20 flex items-center justify-center gap-2",children:["Get Started ",e.jsx(we,{size:14})]})]})]})})})},zt={[R.IDLE]:"bg-gray-500/20 text-gray-400",[R.PROCESSING]:"bg-blue-500/20 text-blue-400 animate-pulse",[R.COMPLETED]:"bg-emerald-500/20 text-emerald-400",[R.FAILED]:"bg-red-500/20 text-red-400",[R.PAUSED]:"bg-amber-500/20 text-amber-400"},Et=({status:n})=>e.jsx("div",{className:`px-2 py-0.5 rounded-md text-[9px] font-black uppercase tracking-widest flex items-center gap-1 ${zt[n]}`,children:n}),Tt=({queue:n,isDark:s,onAddToQueue:o,onRemoveFromQueue:h,onOpenCsvDialog:p})=>{const[b,v]=i.useState(""),[y,C]=i.useState([]),[j,M]=i.useState(null),$=i.useRef(null),O=i.useRef(null),U=()=>{if($.current){const d=$.current.selectionStart,x=$.current.selectionEnd,S=$.current.value.substring(d,x);S.trim().length>0?M({start:d,end:x,text:S}):M(null)}},T=d=>{if(!j||!$.current)return;const{start:x,end:S,text:N}=j,_=$.current.value;let A="";switch(d){case"standard":A=`(${N}:1.2)`;break;case"heavy":A=`((${N}:1.5))`;break;case"ultra":A=`(((${N}:1.8)))`;break;case"echo":A=`${N}... ${N}`;break}const G=_.substring(0,x)+A+_.substring(S);v(G),M(null),$.current.focus()},F=d=>{Array.from(d.target.files||[]).forEach(S=>{const N=new FileReader;N.onload=_=>{var G;const A=(G=_.target)==null?void 0:G.result;C(V=>[...V,A])},N.readAsDataURL(S)}),d.target.value=""},f=()=>{o(b,void 0,y),v(""),C([])};return e.jsxs("div",{className:"space-y-2 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest opacity-40",children:"New Prompt"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{var d;return(d=O.current)==null?void 0:d.click()},className:`p-1.5 rounded-md border transition-all ${s?"bg-white/5 border-white/10":"bg-white border-slate-200 shadow-sm"} ${y.length>0?"text-blue-500 bg-blue-500/10 border-blue-500/30":"opacity-40 hover:opacity-100"}`,children:e.jsx(Ae,{size:14})}),e.jsx("button",{onClick:p,className:`p-1.5 rounded-md border transition-all ${s?"bg-white/5 border-white/10":"bg-white border-slate-200 shadow-sm"} opacity-40 hover:opacity-100`,children:e.jsx(le,{size:14})}),e.jsx("input",{ref:O,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:F})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:$,value:b,onChange:d=>v(d.target.value),onSelect:U,placeholder:"Enter image instructions...",className:`w-full p-2 text-xs min-h-[140px] rounded-md border outline-none transition-all no-scrollbar leading-relaxed ${s?"bg-black/40 border-white/10 focus:border-blue-500/50":"bg-slate-50 border-slate-200 focus:border-blue-500/50 shadow-inner"}`}),j&&e.jsxs("div",{className:"absolute top-0 right-0 -translate-y-full mb-1 flex gap-1 p-1 bg-blue-600 rounded-md shadow-2xl animate-in fade-in slide-in-from-bottom-1 z-50",children:[e.jsx("button",{onClick:()=>T("standard"),title:"Focus",className:"p-1 hover:bg-white/10 rounded-md",children:e.jsx(yt,{size:12})}),e.jsx("button",{onClick:()=>T("heavy"),title:"Emphasis",className:"p-1 hover:bg-white/10 rounded-md",children:e.jsx(tt,{size:12})}),e.jsx("button",{onClick:()=>T("echo"),title:"Highlight",className:"p-1 hover:bg-white/10 rounded-md",children:e.jsx(ft,{size:12})}),e.jsx("button",{onClick:()=>M(null),className:"p-1 hover:bg-white/10 rounded-md border-l border-white/20",children:e.jsx(Q,{size:12})})]}),y.length>0&&e.jsx("div",{className:"absolute left-1 bottom-1 flex gap-1 p-1 bg-black/60 rounded-md overflow-x-auto max-w-[160px] no-scrollbar",children:y.map((d,x)=>e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("img",{src:d,className:"w-8 h-8 rounded-md object-cover",alt:"ref"}),e.jsx("button",{onClick:()=>C(S=>S.filter((N,_)=>_!==x)),className:"absolute -top-1 -right-1 bg-red-600 text-white rounded-md p-0.5",children:e.jsx(Q,{size:6})})]},x))}),e.jsx("button",{onClick:f,className:"absolute right-2 bottom-2 bg-blue-600 text-white px-3 py-1 rounded-md text-[10px] font-black uppercase shadow-lg shadow-blue-600/30 active:scale-95 transition-all",children:"Add to Queue"})]}),e.jsx("div",{className:"pt-2 space-y-1",children:n.length===0?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center opacity-10 gap-2 border-2 border-dashed border-white/5 rounded-md",children:[e.jsx(se,{size:24}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Queue Empty"})]}):n.map(d=>e.jsxs("div",{className:`p-2 rounded-md border group transition-all ${s?"bg-white/2 border-white/5":"bg-white border-slate-100 shadow-sm"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Et,{status:d.status}),e.jsx("button",{onClick:()=>h(d.id),className:"opacity-0 group-hover:opacity-100 text-red-500/40 hover:text-red-500 transition-all p-1",children:e.jsx(X,{size:12})})]}),e.jsxs("p",{className:"text-[10px] font-medium leading-tight line-clamp-2 opacity-80",children:['"',d.originalPrompt,'"']}),d.images&&d.images.length>0&&e.jsx("div",{className:"flex gap-1 mt-2",children:d.images.slice(0,4).map((x,S)=>e.jsx("img",{src:x,className:"w-6 h-6 rounded-md object-cover border border-white/5",alt:"ref"},S))})]},d.id))})]})},_t=({settings:n,isDark:s,hasApiKey:o,onUpdateSettings:h,onOpenApiKeyDialog:p})=>e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-300",children:[e.jsx("div",{className:`p-2 space-y-2 border rounded-md ${s?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest",children:"API Key"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-[9px] font-black uppercase ${o?"text-emerald-500":"text-amber-500"}`,children:o?"Configured":"Not Set"}),e.jsxs("button",{onClick:p,className:`p-2 rounded-md transition-all flex items-center gap-2 text-[10px] font-black uppercase border ${s?"bg-white/5 border-white/10":"bg-white border-slate-200"}`,children:[e.jsx(de,{size:12,className:o?"text-emerald-500":"text-amber-500"}),o?"Update":"Configure"]})]})]})}),e.jsx("div",{className:`p-2 space-y-2 border rounded-md ${s?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest",children:"Interface Theme"}),e.jsxs("button",{onClick:()=>h({theme:s?ee.LIGHT:ee.DARK}),className:`p-2 rounded-md transition-all flex items-center gap-2 text-[10px] font-black uppercase border ${s?"bg-white/5 border-white/10":"bg-slate-100 border-slate-200"}`,children:[s?e.jsx(ye,{size:12,className:"text-amber-400"}):e.jsx(ve,{size:12,className:"text-blue-500"}),s?"Switch to Light":"Switch to Dark"]})]})}),e.jsxs("div",{className:`p-2 space-y-2 border rounded-md ${s?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest ml-1",children:"Active Synthesis Model"}),e.jsxs("select",{value:n.primaryModel,onChange:b=>h({primaryModel:b.target.value}),className:`w-full p-2 rounded-md border text-[10px] font-black uppercase transition-all appearance-none outline-none ${s?"bg-black/40 border-white/10 focus:border-blue-500/50":"bg-white border-slate-200 shadow-sm"}`,children:[e.jsx("option",{value:ne.FLASH,children:"Flash 2.0 (High Speed)"}),e.jsx("option",{value:ne.PRO,children:"Imagen 3 (High Fidelity)"})]})]}),e.jsxs("div",{className:`p-2 space-y-2 border rounded-md ${s?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest ml-1",children:"Global Prefix"}),e.jsx("input",{value:n.prefix,onChange:b=>h({prefix:b.target.value}),placeholder:"Text to prepend to all prompts...",className:`w-full p-2 rounded-md border text-xs outline-none ${s?"bg-black/40 border-white/10":"bg-white border-slate-200"}`})]}),e.jsxs("div",{className:`p-2 space-y-2 border rounded-md ${s?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest ml-1",children:"Global Suffix"}),e.jsx("input",{value:n.suffix,onChange:b=>h({suffix:b.target.value}),placeholder:"Text to append to all prompts...",className:`w-full p-2 rounded-md border text-xs outline-none ${s?"bg-black/40 border-white/10":"bg-white border-slate-200"}`})]}),e.jsx("div",{className:`p-2 space-y-2 border rounded-md ${s?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest block",children:"Sidebar Position"}),e.jsx("p",{className:"text-[8px] opacity-30 mt-1",children:"Where to show Nano Flow panel"})]}),e.jsxs("button",{onClick:()=>h({position:n.position===W.LEFT?W.RIGHT:W.LEFT}),className:`p-2 rounded-md transition-all flex items-center gap-2 text-[10px] font-black uppercase border ${s?"bg-white/5 border-white/10":"bg-slate-100 border-slate-200"}`,children:[n.position===W.LEFT?e.jsx(st,{size:12,className:"text-blue-500"}):e.jsx(nt,{size:12,className:"text-blue-500"}),n.position===W.LEFT?"Left Side":"Right Side"]})]})}),e.jsxs("div",{className:`p-2 space-y-2 border rounded-md ${s?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-1 mb-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest block",children:"Global Negative Prompts"}),e.jsx("p",{className:"text-[8px] opacity-30 mt-1",children:"Things to avoid in all generations"})]}),e.jsx("button",{onClick:()=>h({globalNegativesEnabled:!n.globalNegativesEnabled}),className:`w-10 h-5 rounded-full transition-all relative ${n.globalNegativesEnabled?"bg-blue-600":"bg-white/10"}`,children:e.jsx("div",{className:`absolute w-4 h-4 rounded-full bg-white top-0.5 transition-all shadow-md ${n.globalNegativesEnabled?"left-5":"left-0.5"}`})})]}),e.jsx("textarea",{value:n.globalNegatives,onChange:b=>h({globalNegatives:b.target.value}),placeholder:"Things to avoid in all generations...",disabled:!n.globalNegativesEnabled,className:`w-full p-2 rounded-md border text-xs outline-none min-h-[60px] transition-opacity ${s?"bg-black/40 border-white/10":"bg-white border-slate-200"} ${n.globalNegativesEnabled?"":"opacity-40"}`})]}),e.jsx("div",{className:`p-2 space-y-2 border rounded-md ${s?"border-white/5 bg-white/2":"border-slate-100 bg-slate-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest block",children:"Drip Feed Mode"}),e.jsx("p",{className:"text-[8px] opacity-30 mt-1",children:"Add random delays between generations"})]}),e.jsx("button",{onClick:()=>h({dripFeed:!n.dripFeed}),className:`w-10 h-5 rounded-full transition-all relative ${n.dripFeed?"bg-blue-600":"bg-white/10"}`,children:e.jsx("div",{className:`absolute w-4 h-4 rounded-full bg-white top-0.5 transition-all shadow-md ${n.dripFeed?"left-5":"left-0.5"}`})})]})})]}),Ft=({folders:n,isDark:s,onCreateFolder:o,onDeleteFolder:h,onToggleFolder:p,onUseTemplate:b,onDeleteTemplate:v,onSaveTemplate:y,onImproveTemplate:C,onImproveFolder:j})=>{const[M,$]=i.useState(!1),[O,U]=i.useState(""),[T,F]=i.useState(new Set),[f,d]=i.useState(null),x=i.useRef(null),S=()=>{O.trim()&&(o(O.trim()),U(""),$(!1))},N=(l,c)=>{c.stopPropagation(),confirm("Delete folder and all templates inside?")&&h(l)},_=(l,c,w)=>{w.stopPropagation(),confirm("Delete this template?")&&v(l,c)},A=(l,c,w)=>{if(w&&(w.stopPropagation(),w.preventDefault()),c){const z=n.find(I=>I.id===l),k=z==null?void 0:z.templates.find(I=>I.id===c);k&&d({folderId:l,template:{...k}})}else d({folderId:l,template:{id:Math.random().toString(36).substr(2,9),name:"",text:"",createdAt:Date.now(),lastEditedAt:Date.now(),timesUsed:0,images:[]}})},G=()=>{!f||!f.template.name||(y(f.folderId,f.template),d(null))},V=async(l,c,w)=>{w.stopPropagation(),F(z=>new Set(z).add(c));try{await C(l,c)}finally{F(z=>{const k=new Set(z);return k.delete(c),k})}},J=async(l,c)=>{c.stopPropagation();const w=n.find(k=>k.id===l);if(!w)return;const z=w.templates.map(k=>k.id);F(k=>new Set([...Array.from(k),...z,l]));try{await j(l)}finally{F(k=>{const I=new Set(k);return z.forEach(H=>I.delete(H)),I.delete(l),I})}},B=l=>{Array.from(l.target.files||[]).forEach(w=>{const z=new FileReader;z.onload=k=>{var H;const I=(H=k.target)==null?void 0:H.result;f&&d(K=>K?{...K,template:{...K.template,images:[...K.template.images||[],I]}}:null)},z.readAsDataURL(w)}),l.target.value=""};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("span",{className:"text-[9px] font-black uppercase opacity-40 tracking-widest",children:"Managed Collections"}),e.jsx("button",{onClick:()=>$(!0),className:"p-1.5 rounded-md bg-blue-500/10 text-blue-500 hover:bg-blue-600 hover:text-white transition-all shadow-sm",children:e.jsx(Be,{size:14})})]}),e.jsxs("div",{className:"space-y-2",children:[n.map(l=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>p(l.id),className:`flex-1 flex items-center gap-2 p-2 rounded-md border text-xs font-black transition-all ${s?"bg-white/5 border-white/5 hover:bg-white/10":"bg-slate-50 border-slate-100 hover:bg-slate-100"}`,children:[e.jsx(Ze,{size:14,className:"text-blue-500"}),e.jsx("span",{className:"flex-1 text-left",children:l.name}),e.jsx(Ie,{size:14,className:`transition-transform duration-300 ${l.isOpen?"rotate-180":""}`})]}),e.jsx("button",{onClick:c=>J(l.id,c),disabled:T.has(l.id),title:"Improve all prompts in folder",className:`p-2 rounded-md transition-all ${T.has(l.id)?"bg-amber-500 text-white animate-pulse":"bg-amber-500/10 text-amber-500/60 hover:bg-amber-600 hover:text-white"}`,children:T.has(l.id)?e.jsx(oe,{size:14,className:"animate-spin"}):e.jsx(te,{size:14})}),e.jsx("button",{onClick:c=>N(l.id,c),className:"p-2 rounded-md bg-red-500/10 text-red-500/60 hover:bg-red-600 hover:text-white transition-all",children:e.jsx(X,{size:14})})]}),l.isOpen&&e.jsxs("div",{className:"space-y-1 mt-1 animate-in slide-in-from-top-1",children:[l.templates.map(c=>e.jsx("div",{className:`group flex flex-col p-2 rounded-md border shadow-sm transition-all ${s?"bg-white/2 border-white/5 hover:border-blue-500/30":"bg-white border-slate-50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>b(l.id,c.id),children:[e.jsx("p",{className:"text-[10px] font-black text-blue-500 truncate",children:c.name}),e.jsxs("p",{className:"text-[9px] opacity-40 truncate",children:['"',c.text,'"']})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-all",children:[e.jsx("button",{onClick:w=>V(l.id,c.id,w),disabled:T.has(c.id),className:`p-1 rounded-md transition-all ${T.has(c.id)?"bg-amber-500 text-white animate-pulse":"hover:bg-amber-500/20 text-amber-500"}`,title:"AI Optimization",children:T.has(c.id)?e.jsx(oe,{size:12,className:"animate-spin"}):e.jsx(te,{size:12})}),e.jsx("button",{onClick:w=>A(l.id,c.id,w),className:"p-1 rounded-md hover:bg-blue-500/20",children:e.jsx(dt,{size:12})}),e.jsx("button",{onClick:w=>_(l.id,c.id,w),className:"p-1 rounded-md hover:bg-red-500/20 text-red-500",children:e.jsx(X,{size:12})}),e.jsx("button",{onClick:()=>b(l.id,c.id),className:"p-1 rounded-md bg-blue-600 text-white shadow-lg",children:e.jsx(ht,{size:12})})]})]})},c.id)),e.jsx("button",{onClick:c=>A(l.id,void 0,c),className:"w-full p-2 rounded-md border-2 border-dashed border-white/5 text-[9px] font-black uppercase opacity-20 hover:opacity-100 transition-all",children:"New Style"})]})]},l.id)),n.length===0&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center opacity-10 gap-2 border-2 border-dashed border-white/5 rounded-md",children:[e.jsx(ae,{size:24}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Library Empty"})]})]})]}),M&&e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/80 backdrop-blur-md p-2",children:e.jsxs("div",{className:`max-w-md w-full p-2 rounded-md border shadow-2xl ${s?"glass-panel border-white/10":"bg-white border-slate-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsx("h2",{className:"text-sm font-black",children:"New Folder"}),e.jsx("button",{onClick:()=>$(!1),className:"p-1 hover:bg-white/5 rounded-md transition-all",children:e.jsx(Q,{size:18})})]}),e.jsxs("div",{className:"p-2 space-y-2",children:[e.jsx("input",{autoFocus:!0,value:O,onChange:l=>U(l.target.value),onKeyDown:l=>l.key==="Enter"&&S(),placeholder:"Folder Name",className:`w-full p-2 rounded-md outline-none border text-xs font-bold ${s?"bg-black/40 border-white/10":"bg-slate-50 border-slate-200"}`}),e.jsx("button",{onClick:S,className:"w-full p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-black text-xs",children:"Create"})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 z-[900] flex items-center justify-center bg-black/80 backdrop-blur-md p-2",children:e.jsxs("div",{className:`max-w-xl w-full p-2 rounded-md border shadow-2xl ${s?"glass-panel border-white/10":"bg-white border-slate-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsx("h2",{className:"text-sm font-black",children:f.template.createdAt?"Refine Prompt":"New Library Entry"}),e.jsx("button",{onClick:()=>d(null),className:"p-1 hover:bg-white/5 rounded-md",children:e.jsx(Q,{size:18})})]}),e.jsxs("div",{className:"p-2 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase opacity-40 ml-1",children:"Template Title"}),e.jsx("input",{autoFocus:!0,value:f.template.name,onChange:l=>d({...f,template:{...f.template,name:l.target.value}}),placeholder:"e.g. Dreamy Portrait",className:`w-full p-2 rounded-md outline-none border font-bold text-xs ${s?"bg-black/40 border-white/10":"bg-slate-50 border-slate-200"}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase opacity-40 ml-1",children:"Logic / Modifiers"}),e.jsx("textarea",{value:f.template.text,onChange:l=>d({...f,template:{...f.template,text:l.target.value}}),placeholder:"Add instructions...",className:`w-full p-2 rounded-md outline-none border min-h-[100px] text-xs ${s?"bg-black/40 border-white/10":"bg-slate-50 border-slate-200"}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase opacity-40 ml-1",children:"Assets"}),e.jsxs("div",{onClick:()=>{var l;return(l=x.current)==null?void 0:l.click()},className:`p-2 rounded-md border-2 border-dashed transition-all cursor-pointer flex flex-wrap gap-1 min-h-[80px] items-center justify-center ${s?"bg-white/5 border-white/10 hover:border-blue-500/50":"bg-slate-50 border-slate-200 hover:border-blue-500/50"}`,children:[e.jsx("input",{ref:x,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:B}),!f.template.images||f.template.images.length===0?e.jsxs("div",{className:"flex flex-col items-center gap-1 opacity-20",children:[e.jsx(le,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Select Files"})]}):f.template.images.map((l,c)=>e.jsxs("div",{className:"relative group/asset",onClick:w=>w.stopPropagation(),children:[e.jsx("img",{src:l,className:"w-12 h-12 rounded-md object-cover border border-white/10 shadow-md",alt:"ref"}),e.jsx("button",{onClick:()=>{var w;return d({...f,template:{...f.template,images:(w=f.template.images)==null?void 0:w.filter((z,k)=>k!==c)}})},className:"absolute -top-1.5 -right-1.5 bg-red-600 text-white rounded-md p-1 shadow-lg scale-75 hover:scale-100 transition-transform",children:e.jsx(Q,{size:8})})]},c))]})]}),e.jsxs("button",{onClick:G,className:"w-full p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-black text-xs flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(je,{size:14})," Commit to Library"]})]})]})})]})};function At(){const[n,s]=i.useState([]),[o,h]=i.useState([]),[p,b]=i.useState(ie),[v,y]=i.useState(!1),[C,j]=i.useState("queue"),[M,$]=i.useState(0),[O,U]=i.useState(!1),[T,F]=i.useState(!1),[f,d]=i.useState(!1),x=p.theme===ee.DARK;i.useEffect(()=>{(async()=>{const[t,r,m,u]=await Promise.all([Se(),$e(),Me(),ze()]);s(t),b(r),h(m),U(!u)})()},[]),i.useEffect(()=>Ne(t=>{t[q.QUEUE]&&s(t[q.QUEUE].newValue||[]),t[q.SETTINGS]&&b(t[q.SETTINGS].newValue||ie),t[q.FOLDERS]&&h(t[q.FOLDERS].newValue||[])}),[]),i.useEffect(()=>{const a=t=>{t.type===Z.PROCESS_QUEUE?y(!0):t.type===Z.STOP_PROCESSING?y(!1):t.type===Z.UPDATE_QUEUE&&s(t.payload)};return chrome.runtime.onMessage.addListener(a),()=>chrome.runtime.onMessage.removeListener(a)},[]),i.useEffect(()=>{let a;return v?a=setInterval(()=>$(t=>t+100),100):$(0),()=>clearInterval(a)},[v]);const S=async a=>chrome.runtime.sendMessage(a),N=i.useCallback(a=>{var r;let t=`${p.prefix} ${a} ${p.suffix}`.trim();return p.globalNegativesEnabled&&((r=p.globalNegatives)!=null&&r.trim())&&(t+=`. NOT ${p.globalNegatives.trim()}`),t},[p.prefix,p.suffix,p.globalNegatives,p.globalNegativesEnabled]),_=i.useCallback(async(a,t,r)=>{const P=(a||"").split(/[,\n]/).map(L=>L.trim()).filter(L=>L!=="").map(L=>{const be=t?`${L} ${t}`:L;return{id:Math.random().toString(36).substr(2,9),originalPrompt:L,finalPrompt:N(be),status:R.IDLE,images:r&&r.length>0?[...r]:void 0}}),E=[...n,...P];s(E),await Y(E)},[n,N]),A=i.useCallback(async a=>{const t=n.filter(r=>r.id!==a);s(t),await Y(t)},[n]),G=i.useCallback(async()=>{const a=n.filter(t=>t.status!==R.COMPLETED);s(a),await Y(a)},[n]),V=i.useCallback(async a=>{const t=a.map(m=>{const u=m.modifier?`${m.prompt} ${m.modifier}`:m.prompt;return{id:Math.random().toString(36).substr(2,9),originalPrompt:m.prompt,finalPrompt:N(u),status:R.IDLE}}),r=[...n,...t];s(r),await Y(r)},[n,N]),J=i.useCallback(async()=>{v?(await S({type:Z.STOP_PROCESSING}),y(!1)):(await S({type:Z.PROCESS_QUEUE}),y(!0))},[v]),B=i.useCallback(async a=>{const t={...p,...a};b(t),await ke(t)},[p]),l=i.useCallback(async a=>{await B({apiKey:a})},[B]),c=i.useCallback(async a=>{const t={id:Math.random().toString(36).substr(2,9),name:a,templates:[],isOpen:!0},r=[...o,t];h(r),await D(r)},[o]),w=i.useCallback(async a=>{const t=o.filter(r=>r.id!==a);h(t),await D(t)},[o]),z=i.useCallback(async a=>{const t=o.map(r=>r.id===a?{...r,isOpen:!r.isOpen}:r);h(t),await D(t)},[o]),k=i.useCallback((a,t)=>{const r=o.find(u=>u.id===a),m=r==null?void 0:r.templates.find(u=>u.id===t);m&&(_(m.text,void 0,m.images),j("queue"))},[o,_]),I=i.useCallback(async(a,t)=>{const r=o.map(m=>m.id===a?{...m,templates:m.templates.filter(u=>u.id!==t)}:m);h(r),await D(r)},[o]),H=i.useCallback(async(a,t)=>{const r=o.map(m=>{if(m.id===a){const u=m.templates.findIndex(E=>E.id===t.id),P={id:t.id||Math.random().toString(36).substr(2,9),name:t.name||"Unnamed",text:t.text||"",createdAt:t.createdAt||Date.now(),lastEditedAt:Date.now(),timesUsed:t.timesUsed||0,images:t.images||[]};if(u>-1){const E=[...m.templates];return E[u]=P,{...m,templates:E}}else return{...m,templates:[...m.templates,P]}}return m});h(r),await D(r)},[o]),K=i.useCallback(async(a,t)=>{const r=o.find(u=>u.id===a),m=r==null?void 0:r.templates.find(u=>u.id===t);if(m){const u=await re(m.text),P=o.map(E=>E.id===a?{...E,templates:E.templates.map(L=>L.id===t?{...L,text:u,lastEditedAt:Date.now()}:L)}:E);h(P),await D(P)}},[o]),he=i.useCallback(async a=>{const t=o.find(u=>u.id===a);if(!t)return;const r=await Promise.all(t.templates.map(async u=>{const P=await re(u.text);return{...u,text:P,lastEditedAt:Date.now()}})),m=o.map(u=>u.id===a?{...u,templates:r}:u);h(m),await D(m)},[o]),ue=i.useCallback(async()=>{await Ce(!0),U(!1)},[]);return e.jsxs("div",{className:`flex flex-col h-screen w-full overflow-hidden transition-colors duration-500 ${x?"bg-[#0a0a0a] text-white":"bg-[#f8fafc] text-[#1e293b]"}`,children:[O&&e.jsx(Mt,{onComplete:ue,isDark:x}),e.jsx($t,{isOpen:T,isDark:x,onClose:()=>F(!1),onUpload:V}),e.jsx(St,{isOpen:f,isDark:x,currentKey:p.apiKey,onClose:()=>d(!1),onSave:l}),e.jsxs("div",{className:`p-2 flex items-center justify-between border-b ${x?"border-white/10 bg-white/5":"border-slate-100 bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1 rounded-md bg-blue-600 shadow-lg shadow-blue-600/20",children:e.jsx(ce,{size:16,className:"text-white"})}),e.jsx("h1",{className:"text-sm font-black tracking-tight",children:"Nano Flow"})]}),v&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-blue-500/10 rounded-md border border-blue-500/20",children:[e.jsx(De,{size:10,className:"text-blue-500 animate-spin"}),e.jsxs("span",{className:"text-[10px] font-black text-blue-500",children:[(M/1e3).toFixed(1),"s"]})]})]}),e.jsx("nav",{className:`flex border-b overflow-hidden ${x?"border-white/5 bg-white/2":"border-slate-100"}`,children:[{id:"queue",icon:se,label:"Queue"},{id:"templates",icon:ae,label:"Templates"},{id:"settings",icon:bt,label:"Settings"}].map(a=>e.jsxs("button",{onClick:()=>j(a.id),className:`flex-1 py-3 text-[8px] font-black uppercase tracking-widest flex flex-col items-center gap-1 transition-all relative ${C===a.id?"text-blue-500":"opacity-40 hover:opacity-100"}`,children:[e.jsx(a.icon,{size:14}),e.jsx("span",{className:"truncate w-full text-center px-1",children:a.label}),C===a.id&&e.jsx("div",{className:"absolute bottom-0 left-2 right-2 h-0.5 bg-blue-500 rounded-t-md"})]},a.id))}),e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar p-2",children:[C==="queue"&&e.jsx(Tt,{queue:n,isDark:x,onAddToQueue:_,onRemoveFromQueue:A,onOpenCsvDialog:()=>F(!0)}),C==="templates"&&e.jsx(Ft,{folders:o,isDark:x,onCreateFolder:c,onDeleteFolder:w,onToggleFolder:z,onUseTemplate:k,onDeleteTemplate:I,onSaveTemplate:H,onImproveTemplate:K,onImproveFolder:he}),C==="settings"&&e.jsx(_t,{settings:p,isDark:x,hasApiKey:!!p.apiKey,onUpdateSettings:B,onOpenApiKeyDialog:()=>d(!0)})]}),e.jsxs("div",{className:`p-2 border-t space-y-2 ${x?"bg-black/80 border-white/10 backdrop-blur-xl":"bg-slate-50 border-slate-200"}`,children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:G,className:"flex-1 p-2 rounded-md border text-[10px] font-black uppercase hover:bg-red-500 hover:text-white transition-all border-white/10",children:e.jsx(X,{size:14,className:"mx-auto"})}),e.jsxs("button",{onClick:J,disabled:n.length===0,className:`flex-[4] p-2 rounded-md flex items-center justify-center gap-2 text-xs font-black uppercase shadow-xl transition-all active:scale-[0.98] ${v?"bg-amber-500 shadow-amber-500/30":"bg-blue-600 shadow-blue-600/30"} text-white disabled:opacity-30`,children:[v?e.jsx(rt,{size:16,fill:"currentColor"}):e.jsx(pt,{size:16,fill:"currentColor"}),v?"Stop":"Start"]})]}),n.filter(a=>a.status===R.COMPLETED).length>0&&e.jsx("div",{className:"flex gap-1 overflow-x-auto no-scrollbar py-1",children:n.filter(a=>a.status===R.COMPLETED).slice(-5).map(a=>{var r,m,u,P;const t=((m=(r=a.results)==null?void 0:r.flash)==null?void 0:m.url)||((P=(u=a.results)==null?void 0:u.pro)==null?void 0:P.url);return t?e.jsxs("div",{className:"relative group shrink-0",children:[e.jsx("img",{src:t,className:"w-12 h-12 rounded-md object-cover border border-white/10",alt:"Result"}),e.jsx("button",{onClick:()=>{const E=document.createElement("a");E.href=t,E.download=`nano_flow_${a.id}.png`,E.click()},className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all flex items-center justify-center rounded-md",children:e.jsx(pe,{size:12,className:"text-white"})})]},a.id):null})})]})]})}const me=document.getElementById("root");if(!me)throw new Error("Could not find root element to mount to");const Pt=Ee.createRoot(me);Pt.render(e.jsx(Te.StrictMode,{children:e.jsx(At,{})}));
